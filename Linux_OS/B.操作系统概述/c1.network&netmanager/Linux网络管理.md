# linux 网络配置概述与配置

linux的网络地址并非如现象所示‘与网卡相绑定’，网络却是内核的一项功能。

#### ifconfig配置

```shell
ifconfig -a  																 # 查看所有网卡配置
ifconfig  <网卡ethx>    [ up | down ]  				  		 # 启用&禁用网卡
ifconfig  <网卡ethx>     IP/MASK   [ up | down ]  	  # 立即生效配置的IP ，重试服务失效
ifconfig  <网卡ethx:x>   IP/MASK   [ up | down ]  	 # 配置多IP，网卡别名 
```

#### network&networkmanager

```shell
# 区别 ：networkmanager 相比于前者，技术不够成熟，一般centos6代开始，俩个服务兼而有之；停掉一个不会影响网络，一般初始化时会禁用掉networkmanager，只是用network，所以此块将着重介绍network的配置。

/etc/init.d/network  [ start | restart | stop | status ]  # 启动、重启、停止、检查状态
```

#### route 路由表管理 

```shell
# 几乎任何网络都是要配置网关的，这样才能使得网络贯通；但是重启会失效，最稳妥全面的配置，建议通过配置文件来配置。

# 查看路由
route  -n 
Kernel IP routing table
Destination     Gateway         Genmask                 Flags    Metric    Ref    Use Iface
default            gateway         0.0.0.0            UG     100       0             0       enp0s3
192.168.1.0     0.0.0.0         255.255.255.0   U        100       0             0       enp0s3

# 添加路由
route  add  --net        <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加网络路由
route  add  default     <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加默认路由、
ruote  add  --host      <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加主机路由
 eg ： route add --net 192.168.1.0/24 gw 172.168.0.1
 
 # 删除路由
route  del  --net         <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加网络路由
route   del  default     <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加默认路由、
ruote   del  --host      <目标网域 IP/MASK>  gw  <指定下一跳网关>   # 添加主机路由

# 配置文件指定路由，格式如下，重启后生效
# 配置文件路径： /etc/sysconfig/network-scripts/route-<网卡名>
cat    /etc/sysconfig/network-scripts/route-enp0s3
<目标网域 IP/MASK>  via  <指定下一跳网关>  			# 格式
192.168.1.0/24 			  via  10.0.0.1  							 # 使用10.0.0.1 作为到192.168.1.0网域的下一跳网关 
```

#### 修改配置文件从根本解决问题

```shell
# 网络配置文件路径：/etc/sysconfig/network    可以更改网络主机名，也可以使用命令 hostnamectl  hostname-set xxx
# 网络接口配置文件路径： /etc/sysconfig/network-scripts/ifcfg-<网卡名ethx> 
# 多IP/网卡配置文件设定别名时，设置别名时，别名配置文件不能使用dhcp ！ /etc/sysconfig/network-scripts/ifcfg-<ethx:x>
# Centos6th 代可以直接使用 setup 图形化程序进行配置

# 配置文件参考
 cat    /etc/sysconfig/network-scripts/ifcfg-enp0s3 

NAME="enp0s3"					# 关联的设备名，务须保持一致
DEVICE="enp0s3"    				# 关联的设备名，务须保持一致
BOOTPROTO="static"   		 # 引导协议 [ static | none | dhcp | bootp ]  
IPADDR=192.168.1.20 		 # IP地址
NETMASK=255.255.255.0    # 子网掩码
GATEWAY=192.168.1.1 	   # 默认路由
ONBOOT="yes"   				   # 是否自动开启
HWADDR=""						# 硬件地址，可忽略
TYPE="Ethernet"                 # 网络类型  
UUID="7fdfbe38-a687-4e45-92ea-df08c8838893"  # 绑定唯一标识
DNS1=8.8.8.8 				      # DNS服务器
DNS2=114.114.114.114      # 备用DNS服务器
```

#### DNS服务器配置文件

```shell
# 重启后失效，若网卡配置文件中指定了DNS，则在此处永久显示
# DNS配置文件路径： /etc/resolve.conf

# 概览
 cat    /etc/resolve.conf
 
 # Generated by NetworkManager
nameserver 8.8.8.8
nameserver 114.114.114.114
```

#### host本地解析

```shell
# 熟知DNS工作流时，使用 /etc/hosts 对应需求进行配置
```

#### IP 命令配置网络

```shell
# 此命令功能强大，实用性非常。
ip   a 			 												 # 查看网络接口地址
ip  -s  link show  										  # 统计网络接口接发包

ip  link  set  <网卡名ethx> [ up | down  ]  # 启用禁用网卡 

# 添加ip地址
ip  addr  show  <网卡名>					      # 查看所有ip地址，添加网卡名参数时，只打印匹配相关的ip地址。
ip  addr  add  <IP/MASK>  dev  <网卡名ethx>     				   # 添加ip地址/辅助地址
ip  addr  add  <IP/MASK>  dev  <网卡名ethx>  label  ethx:x  # 添加网卡别名地址

# 删除ip地址
ip  addr  del  <IP/MASK>  dev  <网卡名ethx>     				   # 删除ip地址/辅助地址   
ip  addr  del  <IP/MASK>  dev  <网卡名ethx>  label  ethx:x  # 删除网卡别名地	址 

ip  addr  flush  <网卡名ethx>   to  <IP/MASK>			# 刷掉某网卡某段地址

# 修改路由
ip  route show   	# 查看所有网域路由
ip  route   add  to  <IP/MASK>  dev  <网卡名ethx>  via  <下一跳网关>  # 添加路由
eg： ip  route   add  to  192.168.1.0/24  dev  eth0   via  10.0.0.1
ip  route  flush to  <IP/MASK>   # 刷掉通往某网域的路由
```

